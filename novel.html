<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è¯´è¯¦æƒ…</title>
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 id="novel-title">åŠ è½½ä¸­...</h1>
        </header>

        <div class="wallet-section">
            <button id="connect-wallet">è¿æ¥Wanderé’±åŒ…</button>
            <p>é’±åŒ…åœ°å€: <span class="wallet-address status-disconnected">æœªè¿æ¥</span></p>
        </div>

        <p id="novel-desc" style="font-size:1.1em; line-height:1.6;"></p>
        <p><strong>ä½œè€…ï¼š</strong><span id="novel-author"></span></p>

        <h2>ğŸ“‘ ç« èŠ‚åˆ—è¡¨</h2>
        <div id="chapters-list"></div>
    </div>

    <script type="module" src="common.js"></script>
    <script type="module">
        import { connectWallet, getNovel } from "./common.js";

        document.getElementById('connect-wallet')?.addEventListener('click', connectWallet);

        const urlParams = new URLSearchParams(location.search);
        const novelId = urlParams.get('id');
        if (!novelId) {
            alert('ç¼ºå°‘å°è¯´ID');
            location.href = 'index.html';
        }

        async function load() {
            try {
                const novel = await getNovel(novelId);
                document.getElementById('novel-title').textContent = novel.title || 'æ— æ ‡é¢˜';
                document.title = novel.title || 'å°è¯´è¯¦æƒ…';
                document.getElementById('novel-desc').textContent = novel.description || '';
                document.getElementById('novel-author').textContent = novel.author?.slice(0,12) + '...' || 'æœªçŸ¥';

                const list = document.getElementById('chapters-list');
                if (!novel.chapters || novel.chapters.length === 0) {
                    list.innerHTML = '<p>æš‚æ— ç« èŠ‚</p>';
                    return;
                }
                novel.chapters.forEach((ch, idx) => {
                    const div = document.createElement('div');
                    div.className = 'novel-card';
                    div.innerHTML = `
                        <strong>ç¬¬${idx+1}ç«  ${ch.title || 'æ— æ ‡é¢˜'}</strong>
                        ${ch.isPaid ? '<span style="color:red; margin-left:12px;">ğŸ”’ ä»˜è´¹</span>' : '<span style="color:green; margin-left:12px;">å…è´¹</span>'}
                        ${ch.price > 0 ? ` <span style="margin-left:8px;">(${ch.price} Credits)</span>` : ''}
                    `;
                    div.onclick = () => location.href = `chapter.html?novel=${novelId}&ch=${idx+1}`;
                    list.appendChild(div);
                });
            } catch (e) {
                alert('åŠ è½½å¤±è´¥: ' + e.message);
            }
        }

        load();
    </script>
</body>
</html>
