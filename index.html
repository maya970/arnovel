<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AO å°è¯´å¹³å° - é¦–é¡µ</title>
    <script src="https://unpkg.com/@permaweb/aoconnect/dist/browser.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f6ffed; }
        .container { max-width: 1000px; margin: auto; }
        h1 { text-align: center; color: #389e0d; }
        input[type="text"] { width: 100%; padding: 12px; margin: 20px 0; border-radius: 8px; border: 1px solid #b7eb8f; }
        .novel-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .novel-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #b7eb8f; }
        .novel-card h3 { margin: 0; color: #389e0d; }
        .novel-card a { color: #389e0d; text-decoration: none; font-weight: bold; }
        .novel-card a:hover { text-decoration: underline; }
        .update-time { font-size: 0.9em; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š AO å°è¯´å¹³å°</h1>
        <input type="text" id="search" placeholder="æœç´¢å°è¯´æ ‡é¢˜æˆ–ç®€ä»‹..." />
        <div id="novel-list" class="novel-list"></div>
    </div>

    <script>
        const { dryrun } = window.aoconnect;
        const PROCESS_ID = "51tMVLxBazWMBT9NhfaCuDP3HjQfZOggIcT7l9mRrbw";

        async function loadNovels() {
            try {
                const res = await dryrun({ process: PROCESS_ID, tags: [{name: 'Action', value: 'List-Novels'}] });
                let novels = [];
                try { novels = JSON.parse(res.Messages[0].Data); } catch {} 
                if (!Array.isArray(novels)) novels = [];

                // å‡è®¾è¿›ç¨‹è¿”å›æœ‰ LastUpdate å­—æ®µï¼ŒæŒ‰æ—¶é—´å€’åºï¼ˆæ–°æ›´æ–°åœ¨å‰ï¼‰
                novels.sort((a, b) => (b.LastUpdate || 0) - (a.LastUpdate || 0));

                const listEl = document.getElementById('novel-list');
                listEl.innerHTML = '';
                novels.forEach(novel => {
                    const card = document.createElement('div');
                    card.className = 'novel-card';
                    card.innerHTML = `
                        <h3>${novel.Title || 'æ— æ ‡é¢˜'}</h3>
                        <p>${novel.Description || 'æ— ç®€ä»‹'}</p>
                        <p class="update-time">æœ€åæ›´æ–°: ${novel.LastUpdate ? new Date(novel.LastUpdate * 1000).toLocaleString() : 'æœªçŸ¥'}</p>
                        <a href="novel.html?id=${novel.Id}">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                    `;
                    listEl.appendChild(card);
                });
            } catch (e) {
                document.getElementById('novel-list').innerHTML = '<p>åŠ è½½å¤±è´¥: ' + e.message + '</p>';
            }
        }

        // æœç´¢è¿‡æ»¤ï¼ˆå®¢æˆ·ç«¯ï¼‰
        document.getElementById('search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('.novel-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(term) ? 'block' : 'none';
            });
        });

        loadNovels();
    </script>
</body>
</html>
